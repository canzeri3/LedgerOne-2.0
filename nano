// Central helper to compute the "base URL" for email links.
// Always prefers NEXT_PUBLIC_SITE_URL when set.

function getEnvSiteBase(): string {
  const raw = (process.env.NEXT_PUBLIC_SITE_URL || '').trim()
  if (!raw) return ''
  const cleaned = raw.replace(/\/$/, '')
  return /^https?:\/\//i.test(cleaned) ? cleaned : ''
}

/**
 * Server-side: use env if present, otherwise use the request origin.
 * No hard-coded localhost here (origin may be localhost in dev or Vercel in prod).
 */
export function getServerSiteBase(req: Request): string {
  const envBase = getEnvSiteBase()
  if (envBase) return envBase

  const origin = new URL(req.url).origin
  return origin.replace(/\/$/, '')
}

/**
 * Client-side: use env if present, otherwise window.origin, otherwise a dev fallback.
 * It's okay if the fallback is localhost here because it's client-only.
 */
export function getClientSiteBase(): string {
  const envBase = getEnvSiteBase()
  if (envBase) return envBase

  if (typeof window !== 'undefined' && window.location?.origin) {
    return window.location.origin.replace(/\/$/, '')
  }

  // Client-only dev fallback; never used in server code paths.
  return 'http://localhost:3000'
}

